var healthPointsStr="healthPoints",strengthPointsStr="strengthPoints",activePageStr="activePage",defaultPage="./pages/page_01.html",hp=20,sp=10,activePage=defaultPage;
function load(){localStorage.getItem(activePageStr)&&localStorage.getItem(activePageStr)!=defaultPage&&"./pages/completed.html"!=localStorage.getItem(activePageStr)&&localStorage.getItem(healthPointsStr)&&localStorage.getItem(strengthPointsStr)?showMsg("confirm","You have progress saved.<br><br>Would you like to resume your journey?",function(){hp=localStorage.getItem(healthPointsStr);sp=localStorage.getItem(strengthPointsStr);activePage=localStorage.getItem(activePageStr);loadPage(activePage)},function(){loadPage(activePage)}):
loadPage(activePage)}var onResize=null,onScroll=null,gameplayOnScroll=null;function clearData(){localStorage.clear()}function navigate(a){window.location.href=a}function goHome(){navigate("index.html")}function goPlay(){navigate("play.html")}function goInstruct(){navigate("instructions.html")}function goDie(){clearData();navigate("game-over.html")}function goCredits(){clearData();navigate("credits.html")}
function resetGameplayCtrls(){var a=document.getElementById("btn-roll"),b=document.getElementById("lbl-stats-health"),d=document.getElementById("lbl-stats-strength");a&&(a.onclick=rollDice);b&&(b.innerHTML=hp);d&&(d.innerHTML=sp);window.removeEventListener("resize",onResize,!1);window.removeEventListener("scroll",onScroll,!1);(a=document.getElementById("gameplay-area"))&&a.removeEventListener("scroll",gameplayOnScroll,!1)}
function saveGameDate(){localStorage.setItem(healthPointsStr,hp);localStorage.setItem(strengthPointsStr,sp);localStorage.setItem(activePageStr,activePage);localStorage.setItem("lastSaved",Date.now())}
function loadPage(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){activePage=a;resetGameplayCtrls();saveGameDate();document.getElementById("gameplay-container").innerHTML=b.responseText;var d="init"+a.replaceAll("/","").replaceAll(".","").replace("pages","").replace("html","");if(window[d]&&"function"==typeof window[d])window[d]();else console.log("no init fn for: "+d)}};b.onloadstart=function(){};b.onloadend=function(){};b.onerror=function(){};
b.onabort=function(){};b.open("GET",a,!0);b.setRequestHeader("Cache-Control","no-cache, no-store, max-age=0");b.setRequestHeader("Expires","Tue, 01 Jan 1980 1:00:00 GMT");b.setRequestHeader("Pragma","no-cache");try{b.send()}catch(d){console.error(d.message)}}var isRendering=!1;
function overlayImage(a,b){a.onload=function(){if(isRendering)return!1;isRendering=!0;var d=a.height,g=a.width,e=new Image;e.src=a.src;e.onload=function(){for(var c={},l=0;l<b.length;c={origHeight:c.origHeight,origWidth:c.origWidth,imgOverlay:c.imgOverlay,x:c.x,y:c.y},l++){c.imgOverlay=b[l];c.imgOverlay.style.display="none";c.origHeight=e.height;c.origWidth=e.width;var f=document.createElement("canvas");f.width=e.width;f.height=e.height;var h=f.getContext("2d");h.drawImage(e,0,0);f=h.getImageData(0,
0,f.width,f.height);h=f.data;c.x=0;for(var m=c.y=0,k=0;k<h.length;k+=4){var n=h[k+1],p=h[k+2];if(252==h[k]&&1==n&&161==p){if(l==m){c.x=k/4%f.width;c.y=Math.floor(k/4/f.width);break}m++}}0<c.x&&0<c.y&&(f=new Image,f.src=c.imgOverlay.src,f.onload=function(b){return function(){var c=a.getBoundingClientRect(),e=d/b.origHeight,f=g/b.origWidth;b.imgOverlay.style.left=c.left+b.x*f+"px";b.imgOverlay.style.top=c.top+b.y*e+"px";b.imgOverlay.width=this.width*f;b.imgOverlay.height=this.height*e;b.imgOverlay.style.display=
"inline"}}(c))}};isRendering=!1};onResize=function(){a.onload()};onScroll=function(){a.onload()};gameplayOnScroll=function(){a.onload()};window.addEventListener("resize",onResize,!1);window.addEventListener("scroll",onScroll,!1)}
function diceCallback(a,b,d){var g=a*sp,e=0==g?0:Math.ceil(g/10)-1,c=b[e][0],e=b[e][1];hp-=c;sp-=e;b=function(){loadPage(d)};a="You have rolled a  "+a+" giving you "+g+" attack point(s)";c="<br><br>You have lost:<table><tr><td>Health points:</td><td>"+c+"</td></tr><tr><td>Strength points:</td><td>"+e+"</td></tr></table>";g="<br><br>Remaining:<table><tr><td>Health points:</td><td>"+hp+"</td></tr><tr><td>Strength points:</td><td>"+sp+"</td></tr></table>";0>=hp?showMsg("warning",a+"<br><br>You have run out of health points.<br><br>YOU DIE",
goDie):5>=hp?showMsg("info",a+"<br><br>You have made it through, but only just..."+c+g,b):showMsg("success",a+"<br><br>You have made it through!"+c+g,b)}function mergeImg(){var a=!1,b=0,d=setInterval(function(){var g=(a=!a)?"./img/ouija_bottom.png":"./img/ouija_top.png",e=document.getElementById("gameplay-img");e.classList.add("gameplay-img-fadeout");var c=setTimeout(function(){e.src=g;e.classList.remove("gameplay-img-fadeout");b++;2==b&&(clearInterval(d),clearTimeout(c))},250)},1E3)}
function showKey(){var a=document.getElementById("gameplay-img-overlay");a.src="./img/flower_to_key.gif";setTimeout(function(){a.src="./img/flower_power.png"},1E3)}function findKey(){showMsg("success","You found the key!",function(){loadPage("./pages/page_07.html")})}function confirmGuard(a){showMsg("confirm","Are you sure you want to pick the "+a+"?",function(){"blue guard"==a?loadPage("./pages/page_09.html"):"red guard"==a&&goDie()},null)}
function confirmCandleMace(a){showMsg("confirm","Are you sure you want to pick the "+a+"?",function(){"candle"==a?loadPage("./pages/page_10.html"):"mace"==a&&loadPage("./pages/page_11.html")},null)}function confirmGhoulName(){showMsg("input","What is the name of the sniggering ghoul?<br><br>",function(a,b){"casper"==b.toLowerCase()?(showMsg("success","Your guess is correct..."),loadPage("./pages/page_28.html")):showMsg("warning","Your guess is WRONG!")})}
function confirmGhoulChoice(a,b){showMsg("confirm",b?a?"Are you sure you want to follow Casper's dastardly advice?":"Are you sure you want to ignore Casper's sage advice?":a?"Are you sure you want to ignore Casper's sage advice?":"Are you sure you want to follow Casper's dastardly advice?",function(d,g){a?(showMsg("success",b?"Your were right to trust the ghoul...":"Your were right to distrust the ghoul..."),loadPage("./pages/page_35.html")):showMsg("warning",b?"You should ALWAYS trust a ghoul's advice.":
"You should NEVER trust a ghoul's advice.",goDie)})}function drinkPoison(){showMsg("warning","You drink the potion, and your vision starts to blur...<br><br>You fool! Inside the bottle was poison...<br><br>YOU DIE",goDie)}
function drinkPotion(a,b){showMsg("info",b?"You drink the potion, and feel invigorated!<br><br>2 health points have been added to your total":"You drink the potion, and feel awful!<br><br>2 health points have been removed from your total",function(){hp=b?Number(hp)+Number(2):Number(hp)-Number(2);loadPage(a)},null)}
function confirmWeapon(a){showMsg("confirm","Are you sure you want to choose the "+a+"?",function(){"sword"==a.toLowerCase()?loadPage("./pages/page_36.html"):"bomb"==a.toLowerCase()?loadPage("./pages/page_37.html"):"axe"==a.toLowerCase()&&loadPage("./pages/page_38.html")})}function choseWeapon(a,b){"hp"==b.toLowerCase()?hp=Number(hp)+Number(a):"sp"==b.toLowerCase()&&(sp=Number(sp)+Number(a));loadPage("./pages/page_39.html")}
function showSteppingStone(){var a=document.getElementById("gameplay-img-overlay");a.src="./img/rock.png";setTimeout(function(){a.src="./img/rock_gone.png"},250)}function findSteppingStone(){showMsg("success","You found the stepping stone!",function(){loadPage("./pages/page_40.html")})}function initpage_03(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}
function initpage_04(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[1,1],[1,0],[0,1],[0,0],[0,0]],"./pages/page_05.html")}}function initpage_05(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,2],[2,2],[1,1],[0,0]],"./pages/page_08.html")}}function initpage_06(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}
function initpage_07(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[1,1],[1,0],[0,1],[0,0],[0,0]],"./pages/page_08.html")}}function initpage_08(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay-blue-guard"),d=document.getElementById("gameplay-img-overlay-red-guard");overlayImage(a,[b,d])}
function initpage_09(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay-mace"),d=document.getElementById("gameplay-img-overlay-candle");overlayImage(a,[b,d])}function initpage_10(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[0,0],[0,0],[0,0],[0,0]],"./pages/page_12.html")}}
function initpage_11(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,2],[2,2],[1,1],[0,0]],"./pages/page_12.html")}}function initpage_13(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,2],[2,2],[1,1],[0,0]],"./pages/page_15.html")}}function initpage_24(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}
function initpage_25(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}function initpage_26(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,2],[2,2],[1,1],[0,0]],"./pages/page_27.html")}}function initpage_29(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,0],[0,2],[0,0],[0,0]],"./pages/page_30.html")}}
function initpage_31(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[3,0],[3,0],[2,0],[1,0],[0,0],[0,0]],"./pages/page_32.html")}}function initpage_32(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[2,0],[0,2],[0,0],[0,0]],"./pages/page_35.html")}}function initpage_33(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}
function initpage_35(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay-sword"),d=document.getElementById("gameplay-img-overlay-bomb"),g=document.getElementById("gameplay-img-overlay-axe");overlayImage(a,[b,d,g])}function initpage_39(){var a=document.getElementById("gameplay-img"),b=document.getElementById("gameplay-img-overlay");overlayImage(a,[b])}
function initpage_40(){document.getElementById("btn-roll").onclick=function(){rollDice(diceCallback,[[2,2],[2,2],[1,0],[0,1],[0,0],[0,0]],"./pages/page_41.html")}}
function initpage_42(){document.getElementById("btn-roll").onclick=function(){rollDice(function(a,b,d){a=Number(a)*Number(sp)+Number(hp);b="Your total score is "+a+"<br><br>";30<=a?showMsg("success",b+"You have beaten the mighty <i>King Krillarg</i>!<br><br><i>Castle Quilldore</i> is yours once again...",function(){loadPage("./pages/completed.html")}):showMsg("warning",b+"You do not have enough attack points to defeat the mighty <i>King Krillarg</i>...<br><br>YOU DIE",goDie)})}};
